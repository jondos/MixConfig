<html>
<head>
	<link rel="stylesheet" type="text/css" href="../xhelpfrms.css">
</head>

<body>
<!--#include virtual="/header_en.html"-->

<h2>Admin scripts</h2>

This manual covers helper scripts for the Mix server, an InfoService, a firewall and
a web proxy. They are useful if you often want to update the code with
the newest CVS version.


<h3>Directories</h3>
To run the mix (and optionally an InfoService) you have to create the following
directories:
	<blockquote>
		<code> /home/mix/Mixproxy </code>binaries and configuration for Mix server<br></br>
		<code> /home/mix/InfoService	</code>binaries and configuration for InfoService<br></br>
		<code>/home/mix/InfoService/log	</code>Status statistics of InfoService<br></br>
	</blockquote>

To create a directory, type

	<blockquote>
		<code>
			mkdir [directory name]
		</code>
	</blockquote>


In each of the directories the subdirectories

	<blockquote>
		<code>./backup</code><br>
		<code>./cvs</code><br>
	</blockquote>

will be generated by the scripts.<code>./backup</code> holds old binaries and their
log files. As you see you may easily go back to an old but working installation if an
update has failed.
In <code>./cvs</code> the source files are stored (and overwritten) when getting a new
source code version.



<h3>Executables</h3>
Please put the following executable files in the proper directories. Note that the
InfoService files are optional. There is also a firewall script, but if you want to use
it, you will have to adapt it to your needs first.

<dl>
  <dt><a href="runANONServer">/home/mix/runANONServer</a></dt>
  <dd>common script to start, shutdown update and monitor the Mix and the InfoService</dd>

  <dt><a href="rc.status.anon">/home/mix/rc.status.anon</a></dt>
  <dd>script for printing status messages</dd>

  <dt>/home/mix/Mixproxy/mix</dt>
  <dd>Mix server binary</dd>

  <dt><a href="Mixproxy/runMixproxy">/home/mix/Mixproxy/runMixproxy</a></dt>
  <dd>script to start, shutdown update and monitor the Mix</dd>

  <dt>/home/mix/InfoService/InfoService.jar</dt>
  <dd>InfoService executable jar</dd>

  <dt><a href="InfoService/runInfoService">/home/mix/InfoService/runInfoService</a></dt>
  <dd>script to start, shutdown update and monitor the InfoService</dd>

  <dt><a href="firewall">/home/mix/firewall</a></dt>
  <dd>script to start and shutdown your firewall</dd>
  
   <dt><a href="squidconfigure">/home/mix/squidconfigure</a></dt>
   <dd>configure script for optimizing the squid 2.6 compilation </dd>
</dl>


Make sure that each of these file is really executable by typing
<blockquote>
	<code>chmod -R /home/mix/* +x</code>
</blockquote>



<p>You might also need to convert the executable files to the unix format by installing the <em>sysutils</em> package and typing </p>
<blockquote>
	<code>dos2unix &lt;filename&gt; </code>
</blockquote>

on each of the files.
<h3>Config files</h3>For running the mix, you only need the config file generated by the MixConfig tool.
Please name and place the config files as shown below, otherwise you will have to
adapt one or more of the executable scripts and the links to them.

<dl>
  <dt>/home/mix/Mixproxy/config.xml</dt>
  <dd>config file for the Mix server</dd>

  <dt>/home/mix/InfoService/Infoservice.properties</dt>
  <dd>config file for the Mix server</dd>
  <dt><a href="squid.conf">/home/mix/squid.conf</a></dt>
  <dd>config file for squid proxy </dd>
  <dt><a href="squid-block.acl">/home/mix/squid-block.acl</a></dt>
  <dd>a file containing blocked websites </dd>
</dl>

<h3>Squid proxy installation (for last mixes) </h3>
<p>Download the newest squid 2.6 stable sourcecode from </p>
<blockquote>
		<a href="http://www.squid-cache.org/Versions/v2/2.6/">http://www.squid-cache.org/Versions/v2/2.6/</a>
		</blockquote>

<p>and unpack to /home/mix by typing</p>
<blockquote>
		<code> tar xzf squid-2.6.STABLE6.tar.gz </code>
		</blockquote>
<p>Copy the executable <a href="squidconfigure">squidconfigure</a> into the newly created directory squid-2.6.STABLE6 and type</p>
<blockquote>
		<code> ./squidconfigure </code><br>
		<code> make </code><br>
	<code> make install  </code></blockquote>

<p>Squid is now installed in /usr/local/squid. Link the squid executable to /usr/sbin</p>
<blockquote>
		<code> ln -s /usr/local/squid/sbin/squid /usr/sbin/squid</code><br>
		<code> mv /usr/local/squid/etc/squid.conf </code><code>/usr/local/squid/etc/squid.conf~</code><br>
		<code> ln -s /home/mix/squid.conf /usr/local/squid/etc/squid.conf</code><br>
<code> ln -s /home/mix/squid-bock.acl /usl/local/squid/etc/squid-block.acl </code></blockquote>
Create the cache files
<blockquote>
		<code> mkdir /var/spool/squid</code><br>
		<code> chown proxy:proxy /var/spool/squid</code><br>
		<code> squid -z -d 3 </code><br>
<code> ln -s /home/mix/squid-bock.acl /usl/local/squid/etc/squid-block.acl </code></blockquote>
<p>and start squid:</p>
<blockquote>
		<code> ulimit -HSn 64000 </code><br>
<code> squid </code></blockquote>
<h3>InfoService Libraries</h3>
If you plan to run an InfoService, too, you need to copy the java libraries needed for compilation into
the directory
<blockquote>
	<code>/home/mix/InfoService/lib</code>
</blockquote>
If you choose an other directory, you have to adapt the file
<code>/home/mix/InfoService/runInfoService</code>.

<p> For installing a java compiler and a runtime environment, you will find a very good
installation guide for debian
<a href="http://wiki.serios.net/wiki/Debian_Java_JRE/JDK_installation_from_APT_repositories"> here </a>. </p>


<h3>Links to the executables</h3>
<p>The Mix server, InfoService and the firewall can be started with running
the skripts with the 'start', 'stop' and 'restart' options. With the
'process' option you can list the running processes, 'log' will list the
log file entries. 'status' shows you if the servers are running at the moment.
</p>

You should set some system-wide links, so that you can use the scripts from
every directoy:

	<blockquote>
		<code> su </code><br>
		<code> ln - s /home/mix/firewall /usb/bin/firewall </code><br>
		<code> ln - s /home/mix/Mixproxy/runMixproxy /usr/bin/mixproxy  </code><br>
		<code> ln - s /home/mix/InfoService/runInfoService /usr/bin/infoservice  </code><br>
		<code> exit </code><br>
	</blockquote>

You can test if the Mix server has connected properly to a cascade by tying

<blockquote>
	<code>mixproxy process</code>
</blockquote>

If you see more than one running instance of the server process, everythin is OK.
This can take about a minute after you started the Mix. Another indication is to
check at the end of the logfile for an entry "connected" by typing
<blockquote>
	<code>mixproxy log | less</code>
</blockquote>
and after the log file has opened
<blockquote>
	<code>Shift+G</code>
</blockquote>

<p>You may also update the mix with the newest CVS code by typing</p>
<blockquote>
	<code>mixproxy cvs compile </code><br>
	<code>mixproxy update </code></blockquote>
<p>The firewall has to be started with 'root' rights. If you do not have 'root'
    rights it's normally also ok to restart the system. This will automatically
    also restart the firewall with 'root' privileges. </p>
<h3>Runlevel links</h3>
If you want the services started automatically when starting the server machine, you have
to set links to the executables in runlevel 3 and runlevel 5.

	<blockquote>
		<code> su </code><br>
		<code> ln - s /home/mix/firewall /etc/init.d/firewall </code><br>
		<code> ln - s /home/mix/Mixproxy/runMixproxy /etc/init.d/mixproxy  </code><br>
		<code> ln - s /home/mix/InfoService/runInfoService /etc/init.d/infoservice  </code><br>
		<code> exit </code>
	</blockquote>

<h3>Log files</h3>

New messages will be appended on the end of the logfiles. InfoService can have
more than just one logfile but should be configured with just one central log.
Please configure the Mix/InfoService to store its logs at those positions:

	<blockquote>
		<code>/var/log/messages 
	  </code>messages / logging of your firewall<code><br></br>
			/home/mix/Mixproxy/messages
				</code>messages / logging of the Mix server<code><br></br>
			/home/mix/InfoService/InfoService.log
				</code>messages / logging of InfoService<code><br></br>
			/home/mix/InfoService/log/
				</code>status logs of your cascade<code><br></br>
		</code>
	</blockquote>

<h3>Default runlevel</h3>

The default runlevel has been set to 3 so that the the graphical environment
will not be loaded. This can be changed by the administrator either while the
system is running with:

	<blockquote>
		<code>
			init 5
		</code>
	</blockquote>
or permanently with editing the <code>/etc/inittab</code> entries.

<!--#include virtual="/footer_en.html"-->
</body>
</html>
